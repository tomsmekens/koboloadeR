<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting data from server • koboloadeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting data from server">
<meta property="og:description" content="koboloadeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-142392388-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-142392388-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">koboloadeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Crunching.html">Data Crunching</a>
    </li>
    <li>
      <a href="../articles/How-to.html">Steps to build fully reproducible analysis</a>
    </li>
    <li>
      <a href="../articles/Getting_data.html">Getting data from server</a>
    </li>
    <li>
      <a href="../articles/Troubleshooting.html">Common Troubleshooting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/unhcr/koboloadeR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Getting_data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting data from server</h1>
                        <h4 class="author">Edouard Legoupil</h4>
            
            <h4 class="date">2021-02-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/unhcr/koboloadeR/blob/master/vignettes/Getting_data.Rmd"><code>vignettes/Getting_data.Rmd</code></a></small>
      <div class="hidden name"><code>Getting_data.Rmd</code></div>

    </div>

    
    
<p>The initial step to start your project is to get your data.</p>
<p>The package is using only <code>csv</code> files. this is to avoid the limitations linked the number of columns that some version of excel can handle.</p>
<p>One important point to note is related to the limitation in terms of variable names in R: A syntactically valid name consists of letters, numbers and the dot or underline characters and <strong>starts with a letter or the dot not followed by a number</strong>. Names such as “.2way” or “2.way” are not valid, and neither are the reserved words.</p>
<p>In case your original variable names within your xlsform were starting with a number, you will <strong>need to rename manually</strong> all variable names both in your xlsform and in the data you downloaded.</p>
<div id="case-1-you-have-only-the-data-but-not-the-original-xslform" class="section level2">
<h2 class="hasAnchor">
<a href="#case-1-you-have-only-the-data-but-not-the-original-xslform" class="anchor"></a>Case 1: You have only the data but not the original xslform</h2>
<p>In case, you have simple dataframe, you may load your data in R and then use the function <code><a href="../reference/kobo_to_xlsform.html">kobo_to_xlsform()</a></code></p>
<pre><code>MainDataFrame &lt;- read.csv("data/MainDataFrame.csv")
kobo_to_xlsform(MainDataFrame)
</code></pre>
<p>Note that this function will expect the dataframe headers contains variable names (not labels).</p>
<p>The function will build an xslform file and save it under the data folder. You can then <em>manually</em> edit this file for instance to add the label for your questions.</p>
</div>
<div id="case-2-you-do-not-have-yet-the-data-" class="section level2">
<h2 class="hasAnchor">
<a href="#case-2-you-do-not-have-yet-the-data-" class="anchor"></a>Case 2: You do not have yet the data….</h2>
<p>You have an xlsform - let’s say called <code>form.xls</code> - save it under the data folder and run the following (note that this will take time to process!!):</p>
<pre><code>form &lt;- "form.xls"
## Extend xlsform with necessary column
kobo_prepare_form(form)

### Eventually Generate dummy data (uncomment below if required)
kobo_dummy(form, n = 100)</code></pre>
<p>You can change the value of <code>n</code> to define how many fake records you would like to generate. Note that additional <code>repeat</code> tables will be generated if you form contains those elements.</p>
</div>
<div id="case-3-get-non-hierarchical-data-from-the-server" class="section level2">
<h2 class="hasAnchor">
<a href="#case-3-get-non-hierarchical-data-from-the-server" class="anchor"></a>Case 3: Get non-hierarchical data from the server</h2>
<p>In case your form <strong>does NOT include <code>repeat</code></strong> elements (i.e. the output of your survey is a single flat table), you can use any of the 3 options below:</p>
<div id="using-the-online-interface" class="section level3">
<h3 class="hasAnchor">
<a href="#using-the-online-interface" class="anchor"></a>Using the online interface</h3>
<p>Use the following options within the online interface to extract data <img src="https://raw.githubusercontent.com/unhcr/koboloadeR/gh-pages/inst/script/exportformat.png" alt="alt text"></p>
<p>Now, you can simply copy your data in <code>csv</code> format and your xlsform in <code>xls</code> format in the <code>data</code> folder that was created during the project initiation</p>
</div>
<div id="using-the-shiny-app" class="section level3">
<h3 class="hasAnchor">
<a href="#using-the-shiny-app" class="anchor"></a>Using the Shiny App</h3>
<p>The package contains a Shiny app to access data from the server. It is accessible via</p>
<pre><code><a href="../reference/kobo_apps.html"> kobo_apps("data_viewer")</a></code></pre>
<p>The <code>data_viewer</code> app provides a basic login screen to authenticate against the specified API. Once authenticated, the datasets available via the specified login are displayed, and a dropdown list is populated with which one can select the dataset they want to view. The dataset is also made available in the users Global Environment.</p>
<p>Here’s <a href="http://news.mrdwab.com/post/koboloader/">a blog post introducing this specific function</a>!</p>
</div>
<div id="from-api-with-comand-line" class="section level3">
<h3 class="hasAnchor">
<a href="#from-api-with-comand-line" class="anchor"></a>From API with comand line</h3>
<p>You can grab your data with the functions <code>kobo_data_downloader</code> &amp; get your form with <code>kobo_form</code></p>
<p>The following examples access the public data available via KoBo Toolbox.</p>
<p>Note that all of the functions have been set with defaults of <code>user = NULL</code> and <code>api = 'kobo'</code>.</p>
<pre><code>kobo_datasets()[, c("description", "id"), with = FALSE] ## Just show the first two columns
#                                                    description    id
#   1:                                关于“西装微定制现状的调查“ 10427
#   2:                زانیاری لەسەر كۆمپانیاكانی نەوت لە گەرمیان 11190
#   3:                           מיפוי שדרות צ'רצ'יל - ורד ויואב 12568
#   4:                                                      Test 39717
#   5:                                             Market Survey  7640
#  ---                                                                
# 403: Webuy_Stock lot Business (No.1 Stock Bazar in Bangladesh) 30792
# 404:                               WWF Zambia [Field Reporter]  4163
# 405:                                         xls_form_training 41820
# 406:                                    Mwanza KAP SURVEY 2015 25206
# 407:                                    Elisha Zelina, GST6109  1857

kobo_submission_count(4163)
# [1] 37

kobo_data_downloader("4163")
# No local dataset found.
# Downloading remote file.
# ... The contents would normally be printed here

### On a subsequent run, if the file is already there and no changes have been made
kobo_data_downloader("4163")
# Number of rows in local and remote file match.
# Using local file.</code></pre>
<p>The <code>kobo_data_downloader</code> automatically checks for the existence of an object in your workspace named “data_####” (where “####” is the numeric form ID). If such an object is found, it then uses <code>kobo_submission_count</code> to compare the number of rows in the local dataset against the number of rows in the remote dataset. If the number is found to be different, the remote dataset is re-downloaded. If they are found to be the same, the local dataset is used.</p>
<p>In the future, it is intended that there would be a more robust and efficient method rather than redownloading the entire dataset each time a change has been detected.</p>
<hr>
<p>Run the examples at the help pages to get a sense of some of the other features:</p>
<pre><code><a href="https://rdrr.io/r/utils/example.html">example("kobo_datasets")
example("kobo_submission_count")
example("kobo_data_downloader")</a></code></pre>
</div>
</div>
<div id="authentication" class="section level2">
<h2 class="hasAnchor">
<a href="#authentication" class="anchor"></a>Authentication</h2>
<p>These functions all use basic HTTP authentication. The easiest way to enter the password details is the common <code>"username:password"</code> approach. Thus, when accessing form data using authentication, the function would be used in the following manner:</p>
<pre><code><a href="../reference/kobo_data_downloader.html">kobo_data_downloader("123456", "username:password")</a></code></pre>
</div>
<div id="case-4-get-hierarchical-data" class="section level2">
<h2 class="hasAnchor">
<a href="#case-4-get-hierarchical-data" class="anchor"></a>Case 4: Get hierarchical data</h2>
<p>In case your form <strong>includes <code>repeat</code></strong> elements (i.e. the output of your survey is a single flat table), you can use any of the 3 options below:</p>
<div id="using-the-online-interface-1" class="section level3">
<h3 class="hasAnchor">
<a href="#using-the-online-interface-1" class="anchor"></a>Using the online interface</h3>
<p>When using the online interface, the only options to download hierachical data is to have an xls extract. This may <a href="https://community.kobotoolbox.org/t/export-repeat-tables-as-zipped-csv-files-from-api/3928">come with limitations</a> that can be handled only through the second option below.</p>
<p>Once you have your xls extract, simply save each of the worksheet as distinct <code>csv</code> files. Note that within the package <code>MainDataFrame</code> is the default name used for the root frame.</p>
</div>
<div id="using-odk-briefcase" class="section level3">
<h3 class="hasAnchor">
<a href="#using-odk-briefcase" class="anchor"></a>Using ODK briefcase</h3>
<p><a href="https://docs.opendatakit.org/briefcase-intro/">ODK Briefcase</a> ODK Briefcase is a desktop application for pulling, pushing, and converting form data on servers. Please consult the documentatio directly for more guidances.</p>
</div>
<div id="using-odkr-package" class="section level3">
<h3 class="hasAnchor">
<a href="#using-odkr-package" class="anchor"></a>Using odkR package</h3>
<p>The odkR package embbed ODK briefcase. See the <a href="https://validmeasures.org/odkr/">odkr package documentation</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Edouard Legoupil, Maher Daoud, Hisham Galal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
